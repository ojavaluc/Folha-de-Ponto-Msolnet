<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Ponto</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header>
    <div class="header-container">
      <h1>Controle de Ponto</h1>
      <div class="header-right">
        <div id="clock">00:00:00</div>
        <button id="theme-toggle">
          <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
          <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </button>
      </div>
    </div>
  </header>

  <div id="feedback-message" class="feedback hidden"></div>

  <div class="container">
    <h2>Registrar Ponto</h2>
    <div class="form">
      <div class="input-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        <input type="password" id="senha" placeholder="Digite sua senha (6 d√≠gitos)" maxlength="6" />
      </div>
      <select id="tipo">
        <option value="Chegada">‚úÖ Chegada</option>
        <option value="Sa√≠da para Almo√ßo">üçΩÔ∏è Sa√≠da para Almo√ßo</option>
        <option value="Volta do Almo√ßo"> ‡§µ‡§æ‡§™‡§∏ Volta do Almo√ßo</option>
        <option value="Fim do Expediente">üèÅ Fim do Expediente</option>
      </select>
      <button onclick="registrarPonto()">Registrar</button>
      <button onclick="acessarAdmin()" class="btn-secondary">√Årea do Administrador</button>
    </div>

    <h3 class="table-title">√öltimos Registros</h3>
    <div class="table-wrapper">
      <table id="tabela">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Tipo</th>
            <th>Data</th>
            <th>Hora</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const registros = JSON.parse(localStorage.getItem('registros')) || [];
    const funcionarios = JSON.parse(localStorage.getItem('funcionarios')) || [];

    // --- NOVAS FUN√á√ïES DE INTERFACE ---

    // Fun√ß√£o para mostrar feedback na tela
    function showFeedback(message, type = 'success') {
      const feedbackEl = document.getElementById('feedback-message');
      feedbackEl.textContent = message;
      feedbackEl.className = `feedback ${type}`; // Remove 'hidden' e adiciona tipo
      
      // Esconde a mensagem ap√≥s 4 segundos
      setTimeout(() => {
        feedbackEl.className = 'feedback hidden';
      }, 4000);
    }

    // Fun√ß√£o para o rel√≥gio digital
    function updateClock() {
      const clockEl = document.getElementById('clock');
      if(clockEl) {
        clockEl.textContent = new Date().toLocaleTimeString('pt-BR');
      }
    }
    
    // Tema Escuro (Dark Mode)
    const themeToggle = document.getElementById('theme-toggle');
    const sunIcon = document.getElementById('theme-icon-sun');
    const moonIcon = document.getElementById('theme-icon-moon');

    const applyTheme = (theme) => {
      document.body.className = theme;
      sunIcon.style.display = theme === 'dark-mode' ? 'none' : 'block';
      moonIcon.style.display = theme === 'dark-mode' ? 'block' : 'none';
    };

    themeToggle.addEventListener('click', () => {
      const newTheme = document.body.className === 'dark-mode' ? '' : 'dark-mode';
      localStorage.setItem('theme', newTheme);
      applyTheme(newTheme);
    });

    // --- FUN√á√ïES PRINCIPAIS DO SISTEMA ---

    function registrarPonto() {
      const senha = document.getElementById('senha').value.trim();
      const tipo = document.getElementById('tipo').value;

      if (!senha || senha.length !== 6) {
        showFeedback('Digite sua senha de 6 d√≠gitos.', 'error');
        return;
      }

      const funcionario = funcionarios.find(f => f.senha === senha);

      if (!funcionario) {
        showFeedback('Senha n√£o encontrada. Verifique com o administrador.', 'error');
        return;
      }

      const agora = new Date();
      const data = agora.toLocaleDateString('pt-BR');
      const hora = agora.toLocaleTimeString('pt-BR');

      registros.push({ nome: funcionario.nome, tipo, data, hora });
      localStorage.setItem('registros', JSON.stringify(registros));
      
      showFeedback(`Ponto registrado com sucesso, ${funcionario.nome}!`, 'success');
      atualizarTabela();
      document.getElementById('senha').value = '';
    }

    function atualizarTabela() {
      const tbody = document.querySelector('#tabela tbody');
      tbody.innerHTML = '';
      
      // Pega apenas os 10 registros mais recentes para n√£o poluir a tela
      const registrosRecentes = [...registros].reverse().slice(0, 10);

      registrosRecentes.forEach(r => {
        const linha = `<tr>
          <td>${r.nome}</td>
          <td>${r.tipo}</td>
          <td>${r.data}</td>
          <td>${r.hora}</td>
        </tr>`;
        tbody.innerHTML += linha;
      });
    }

    function acessarAdmin() {
      window.location.href = 'login.html';
    }

    // --- INICIALIZA√á√ÉO ---
    document.addEventListener('DOMContentLoaded', () => {
        // Carrega o tema salvo
        const savedTheme = localStorage.getItem('theme') || '';
        applyTheme(savedTheme);
        
        // Atualiza a tabela e o rel√≥gio
        atualizarTabela();
        setInterval(updateClock, 1000);
        updateClock(); // Primeira chamada imediata
    });
  </script>
</body>
</html>
